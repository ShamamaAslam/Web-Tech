<%- include("../layouts/main", {
  title: title || "Admin",
  pageCss: pageCss || "admin.css",
  body: `
  <div class="admin-wrap">
    <div class="admin-head">
      <h1>Dashboard</h1>
      <div class="admin-nav">
        <a href="/admin" class="pill active">Dashboard</a>
        <a href="/admin/products" class="pill">Products</a>
        <a href="/admin/orders" class="pill">Orders</a>
        <a href="/admin/appointments" class="pill">Appointments</a>
        <a href="/admin/messages" class="pill">Messages</a>
        <a href="/purchase" class="pill ghost">Back to Site</a>
      </div>
    </div>

    <div class="cards">
      <div class="card"><div class="label">Total Products</div><div class="num">${totalProducts}</div></div>
      <div class="card"><div class="label">Total Orders</div><div class="num">${totalOrders}</div></div>
      <div class="card"><div class="label">Total Revenue</div><div class="num">Rs ${totalRevenue}</div></div>
      <div class="card"><div class="label">Appointments</div><div class="num">${totalAppointments}</div></div>
      <div class="card"><div class="label">Messages</div><div class="num">${totalMessages}</div></div>
    </div>

    <div class="grid2">
      <div class="panel">
        <div class="panel-title">
          <h2>Recent Orders</h2>
          <a href="/admin/orders">View all</a>
        </div>
        ${recentOrders.length ? `
          <table class="table">
            <thead><tr><th>Date</th><th>Buyer</th><th>Total</th><th></th></tr></thead>
            <tbody>
              ${recentOrders.map(o => `
                <tr>
                  <td>${new Date(o.createdAt).toLocaleString()}</td>
                  <td>${o.buyer?.name || "-"}</td>
                  <td>Rs ${o.total}</td>
                  <td><a class="link" href="/admin/orders/${o._id}">Details</a></td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        ` : `<p class="muted">No orders yet.</p>`}
      </div>

      <div class="panel">
        <div class="panel-title">
          <h2>Recent Appointments</h2>
          <a href="/admin/appointments">View all</a>
        </div>
        ${recentAppointments.length ? `
          <table class="table">
            <thead><tr><th>Date/Time</th><th>Patient</th><th>Phone</th></tr></thead>
            <tbody>
              ${recentAppointments.map(a => `
                <tr>
                  <td>${a.appointmentDate} ${a.appointmentTime}</td>
                  <td>${a.patientName}</td>
                  <td>${a.phone}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>
        ` : `<p class="muted">No appointments yet.</p>`}
      </div>
    </div>

    <div class="panel">
      <div class="panel-title">
        <h2>Recent Messages</h2>
        <a href="/admin/messages">View all</a>
      </div>
      ${recentMessages.length ? `
        <table class="table">
          <thead><tr><th>Date</th><th>Name</th><th>Email</th><th>Subject</th></tr></thead>
          <tbody>
            ${recentMessages.map(m => `
              <tr>
                <td>${new Date(m.createdAt).toLocaleString()}</td>
                <td>${m.name}</td>
                <td>${m.email}</td>
                <td>${m.subject || "-"}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      ` : `<p class="muted">No messages yet.</p>`}
    </div>
  </div>
  `
}) %>
